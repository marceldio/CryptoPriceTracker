# CryptoPriceTracker

Задание:
1. Написать для криптобиржи Deribit (https://docs.deribit.com/)
асинхронный клиент на aiohhtp. Клиент должен каждую минуту забирать
с биржи текущую цену btc_usd и eth_usd (index price валюты) после
чего сохранять в базу данных тикер валюты, текущую цену и время в
UNIX timestamp.
2. Написать внешнее API для обработки сохраненных данных на FastAPI.
Обязательные требования:
1. API должно включать в себя следующие методы:
- Получение всех сохраненных данных по указанной валюте
- Получение последней цены валюты
- Получение цены валюты с фильтром по дате
Все методы должны быть GET и у каждого метода дожен быть
обязятельный query-параметр "ticker".
2. Код выложить на гитхаб с подробным readme и документацией по
разворачиванию.
Можно использовать любую БД на выбор для хранения цен.
Необязательные требования:
1. Написать тесты для клиента
2. Развернуть приложение в докер контейнере.
3. Написать github actions для автотестов.
Критерии оценки:
1. Чистая архитектура/чистый код
2. Нейминг
3. Отсутсвие глобальных переменных
4. Умение использовать ООП

Декомпозиция задачи.
План реализации:
Создание асинхронного клиента на aiohttp:
Подключение к API биржи Deribit.
Получение индексов цен BTC-USD и ETH-USD.
Сохранение данных в базу (PostgreSQL).
Реализация внешнего API с помощью FastAPI:
Маршруты:
Получение всех данных по тикеру.
Получение последней цены тикера.
Получение цены с фильтром по дате.
Хранилище данных:
База данных PostgreSQL.
ORM: SQLAlchemy (асинхронная).
Docker:
Настройка Dockerfile и docker-compose для поднятия FastAPI, базы данных и асинхронного клиента.
Тесты:
Покрытие клиента и API тестами (pytest, HTTP-клиент FastAPI).
Примечание:
Фильтрация предупреждений DeprecationWarning В текущей версии pytest-asyncio возникает предупреждение о 
переопределении фикстуры event_loop. Несмотря на то, что этот подход устарел, он остаётся стабильным и рабочим. 
Фильтрация предупреждений добавлена в pytest.ini, чтобы избежать шума в выводе тестов. Планируется обновление 
кода после появления стабильной версии библиотеки с поддержкой нового подхода.

CI/CD:
GitHub Actions для автотестов.
Документация:
Подробное описание работы клиента и API.
Инструкции по развертыванию (локально и в Docker).


# Инструкция по запуску проекта CryptoPriceTracker

1. Предварительные требования
Перед запуском проекта убедитесь, что на вашем компьютере установлены:
Python 3.12
Poetry
Docker и Docker Compose

2. Клонирование репозитория
Склонируйте проект из GitHub.

3. Настройка переменных окружения
Файлы окружения
.env: используется для локального запуска проекта без Docker.
.env.docker: используется для запуска проекта в Docker.
Создайте и отредактируйте эти файлы в соответствии с вашими настройками. Пример содержимого .env.docker:

POSTGRES_DB=name_database
POSTGRES_USER=user
POSTGRES_PASSWORD=password
DATABASE_URL=postgresql+asyncpg://user:password@db:5432/name_database

4. Локальный запуск проекта
Установка зависимостей
Установите зависимости с помощью Poetry:
poetry install
Инициализация базы данных
Примените миграции для создания базы данных:
poetry run python -m app.database
Запуск сервера
Запустите сервер FastAPI:
poetry run uvicorn app.main:app --reload
Сервер будет доступен по адресу: http://127.0.0.1:8000

5. Запуск проекта в Docker
Сборка контейнеров
Выполните сборку Docker-контейнеров:
docker-compose --env-file .env.docker build
Запуск контейнеров
Запустите контейнеры в фоновом режиме:
docker-compose --env-file .env.docker up -d
Проверка работы контейнеров
Убедитесь, что все контейнеры запущены:
docker-compose ps
Остановка контейнеров
Чтобы остановить контейнеры, выполните:
docker-compose down

6. Тестирование проекта
Для запуска тестов выполните команду:
poetry run pytest --cov
Это обеспечит проверку работоспособности кода и покрытия тестами.

7. Работа с проектом
Эндпоинты API
GET /prices/: Получить все данные по тикеру.
GET /prices/last/: Получить последний индекс цены для тикера.
GET /prices/filter/: Получить данные по тикеру за определенный период.

Документация доступна по адресу: http://127.0.0.1:8000/docs

8. Обновление данных
В проекте реализован фоновый клиент DeribitClient, 
который автоматически обновляет базу данных каждые 60 секунд при запуске сервера. 
Убедитесь, что сервер работает, чтобы данные обновлялись корректно.